<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="/manifest.json">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Doodh Hisaab</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="h-screen w-screen flex flex-col overflow-hidden">

    <!-- SPLASH SCREEN -->
    <div id="splash-screen">
        <div class="glass-container mb-6" style="height: 120px; width: 90px; border-bottom-color: white;">
            <div class="milk-level" style="height: 0%; animation: fillUp 2s ease-in-out forwards;">
                <div class="wave"></div>
            </div>
        </div>
        <h1 class="text-2xl font-bold text-theme-main animate-pulse">Doodh Hisaab</h1>
        <p class="text-sm text-theme-muted mt-2">Starting App...</p>
        <style>
            @keyframes fillUp { 0% { height: 0%; } 100% { height: 80%; } }
        </style>
    </div>

    <!-- HEADER -->
    <header class="bg-theme-card px-4 py-3 shadow-md z-20 flex justify-between items-center border-b border-theme pt-safe shrink-0 transition-colors duration-300">
        <div class="flex items-center gap-3">
            <div class="bg-blue-600 p-2 rounded-xl text-white shadow-lg">
                <i data-lucide="milk" class="w-5 h-5"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg leading-none text-theme-main">Doodh Hisaab</h1>
                <p class="text-xs text-theme-muted font-medium" id="header-date-display">Aaj</p>
            </div>
        </div>
        <button id="btn-settings" class="p-2 bg-theme-main active:opacity-70 rounded-full text-theme-muted transition-colors border border-theme">
            <i data-lucide="settings" class="w-5 h-5"></i>
        </button>
    </header>

    <!-- MAIN CONTAINER -->
    <main class="flex-1 overflow-hidden relative w-full max-w-md mx-auto" id="main-container">

        <!-- === VIEW 1: ENTRY === -->
        <div id="entry-view" class="h-full flex flex-col items-center justify-between p-4 pb-24 pt-2 animate-fade-in">
            
            <!-- Date Nav -->
            <div class="w-full flex justify-center shrink-0">
                <div id="quick-date-nav" class="flex bg-theme-card rounded-full p-1 shadow-inner border border-theme w-full max-w-[280px]">
                    <button id="btn-today" class="flex-1 py-1.5 px-4 rounded-full text-xs font-bold transition-all bg-blue-600 text-white shadow-md">
                        Aaj (Today)
                    </button>
                    <button id="btn-yesterday" class="flex-1 py-1.5 px-4 rounded-full text-xs font-bold text-theme-muted transition-all hover:bg-theme-main">
                        Kal (Yesterday)
                    </button>
                </div>
                <!-- Edit Banner -->
                <div id="edit-mode-banner" class="hidden w-full max-w-[280px] bg-amber-900/30 border border-amber-600/50 rounded-lg p-1.5 text-center">
                    <p class="text-amber-500 text-xs font-bold flex items-center justify-center gap-2">
                        <i data-lucide="calendar" class="w-3 h-3"></i>
                        Editing Past Date
                    </p>
                </div>
            </div>

            <!-- Glass Visual -->
            <div class="flex flex-col items-center justify-center flex-1 w-full relative min-h-0">
                <div class="glass-container">
                    <div class="milk-level" id="milk-visual" style="height: 0%;">
                        <div class="wave"></div>
                    </div>
                </div>
                <div class="mt-4 flex flex-col items-center z-10">
                    <div class="flex items-baseline gap-1">
                        <span id="quantity-display" class="text-5xl font-bold text-theme-main tracking-tight drop-shadow-xl">0.0</span>
                        <span class="text-lg text-blue-400 font-medium">Litr</span>
                    </div>
                    <p id="status-text" class="text-xs text-theme-muted font-medium mt-1">Niche tap karke add karein</p>
                </div>
            </div>

            <!-- Controls -->
            <div class="w-full max-w-[300px] flex flex-col gap-2 shrink-0 mb-1">
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="addMilk(0.5)" class="tap-btn bg-theme-card border border-theme p-2 rounded-xl flex flex-row items-center justify-center gap-3 shadow-lg active:border-blue-500 group">
                        <div class="w-9 h-11 bg-theme-main rounded flex items-center justify-center border border-theme group-active:bg-blue-600 group-active:border-blue-400 transition-colors">
                            <span class="text-[10px] font-bold text-blue-400 group-active:text-white">500<br>ml</span>
                        </div>
                        <span class="font-bold text-theme-muted text-xs group-active:text-blue-500">Chhota</span>
                    </button>

                    <!-- FIXED 1L LAYOUT HERE -->
                    <button onclick="addMilk(1.0)" class="tap-btn bg-theme-card border border-theme p-2 rounded-xl flex flex-row items-center justify-center gap-3 shadow-lg active:border-blue-500 group">
                        <div class="w-9 h-11 bg-blue-600 rounded flex flex-col items-center justify-center shadow-lg border border-blue-500 leading-none">
                            <span class="text-xl font-bold text-white mb-0">1</span>
                            <span class="text-[8px] font-bold text-blue-100 uppercase tracking-wider">Ltr</span>
                        </div>
                        <span class="font-bold text-theme-muted text-xs group-active:text-blue-500">Bada</span>
                    </button>
                </div>

                <div class="flex gap-3">
                    <button onclick="clearEntry()" class="tap-btn flex-1 py-3 rounded-xl bg-theme-card text-theme-muted font-bold text-xs flex items-center justify-center gap-2 border border-theme">
                        <i data-lucide="rotate-ccw" class="w-3 h-3"></i> Clear
                    </button>
                    <button onclick="markNoMilk()" class="tap-btn flex-1 py-3 rounded-xl bg-red-900/20 text-red-500 font-bold text-xs flex items-center justify-center gap-2 border border-red-500/20">
                        <i data-lucide="ban" class="w-3 h-3"></i> Chutti
                    </button>
                </div>

                <button onclick="saveEntry()" class="tap-btn w-full bg-green-600 active:bg-green-700 text-white py-3.5 rounded-xl font-bold text-base shadow-xl flex items-center justify-center gap-2 border-t border-green-400/20 mt-1">
                    <i data-lucide="check-circle-2" class="w-5 h-5"></i>
                    <span>SAVE ENTRY</span>
                </button>
            </div>
        </div>

        <!-- === VIEW 2: HISAAB === -->
        <div id="hisaab-view" class="hidden h-full overflow-hidden p-4 flex flex-col justify-between pb-24 pt-2">
            <!-- Bill Card -->
            <div class="bg-gradient-to-br from-blue-600 to-blue-800 rounded-2xl p-4 text-white card-shadow relative overflow-hidden border border-blue-400/30 shrink-0">
                <div class="absolute -right-4 -top-4 text-blue-500/20 transform rotate-12">
                    <i data-lucide="indian-rupee" class="w-32 h-32"></i>
                </div>
                <div class="relative z-10">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-blue-200 text-[10px] font-bold uppercase tracking-wider mb-1">Poora Bill</p>
                            <div class="flex items-baseline gap-1">
                                <span class="text-2xl font-bold opacity-80">₹</span>
                                <span class="text-4xl font-bold" id="total-bill-display">0</span>
                            </div>
                        </div>
                        <div class="bg-white/10 backdrop-blur-sm p-2 rounded-lg border border-white/10">
                            <i data-lucide="wallet" class="w-5 h-5 text-blue-100"></i>
                        </div>
                    </div>
                    <div class="mt-3 flex gap-6 text-blue-50 text-xs border-t border-white/10 pt-3">
                        <div>
                            <p class="text-blue-200">Kul Doodh</p>
                            <p class="font-bold text-base"><span id="total-liters-display">0</span> L</p>
                        </div>
                        <div id="btn-rate-edit" class="cursor-pointer active:opacity-70">
                            <p class="text-blue-200 flex items-center gap-1">Rate <i data-lucide="pencil" class="w-3 h-3"></i></p>
                            <p class="font-bold text-base">₹<span id="current-rate-display">60</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar -->
            <div class="bg-theme-card rounded-2xl shadow-lg border border-theme overflow-hidden flex flex-col flex-1 min-h-0 my-3 transition-colors duration-300">
                <div class="flex justify-between items-center p-2 bg-theme-nav border-b border-theme shrink-0">
                    <button onclick="changeMonth(-1)" class="p-2 text-theme-muted active:opacity-50 rounded-lg"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                    <span class="font-bold text-sm text-theme-main" id="calendar-month-display">Dec 2025</span>
                    <button onclick="changeMonth(1)" class="p-2 text-theme-muted active:opacity-50 rounded-lg"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                </div>
                
                <div class="p-2 flex-1 flex flex-col justify-center">
                    <div class="calendar-grid mb-1 text-center text-[10px] text-theme-muted font-bold uppercase">
                        <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
                    </div>
                    <div id="calendar-days" class="calendar-grid text-xs font-medium text-theme-muted">
                        <!-- JS renders here -->
                    </div>
                </div>
            </div>

            <button onclick="shareOnWhatsapp()" class="tap-btn w-full bg-green-600 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 shadow-lg shadow-green-900/40 border border-green-500/30 shrink-0">
                <i data-lucide="message-circle" class="w-5 h-5"></i>
                WhatsApp Share
            </button>
        </div>

    </main>

    <!-- BOTTOM NAV -->
    <nav class="fixed bottom-0 left-0 w-full bg-theme-nav border-t border-theme flex justify-around items-center p-2 z-30 pb-safe shadow-[0_-10px_40px_rgba(0,0,0,0.2)] transition-colors duration-300">
        <button onclick="switchTab('entry')" id="nav-entry" class="tap-btn flex flex-col items-center gap-1 p-2 rounded-xl text-blue-500 w-1/2">
            <i data-lucide="plus-circle" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold">Entry</span>
        </button>
        <button onclick="switchTab('hisaab')" id="nav-hisaab" class="tap-btn flex flex-col items-center gap-1 p-2 rounded-xl text-theme-muted w-1/2">
            <i data-lucide="layout-grid" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold">Hisaab</span>
        </button>
    </nav>

    <!-- SETTINGS MODAL -->
    <div id="settings-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-end sm:items-center justify-center animate-fade-in">
        <div class="bg-theme-card w-full max-w-sm mx-auto p-6 rounded-t-3xl sm:rounded-3xl border-t border-theme sm:border shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-lg font-bold text-theme-main">Settings</h2>
                <button id="close-settings" class="p-2 bg-theme-main rounded-full text-theme-muted"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-medium text-theme-muted mb-2">Milk Rate (₹)</label>
                    <input type="number" id="rate-input" class="w-full bg-theme-main border border-theme text-theme-main text-lg font-bold rounded-xl py-3 pl-4 outline-none focus:border-blue-500" placeholder="60">
                </div>

                <!-- Theme Toggle -->
                <div class="flex items-center justify-between p-3 bg-theme-main rounded-xl border border-theme">
                    <div class="flex items-center gap-3">
                        <i data-lucide="moon" class="w-5 h-5 text-blue-400"></i>
                        <span class="font-bold text-sm text-theme-main">Dark Mode</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="theme-toggle" class="sr-only peer">
                        <div class="w-9 h-5 bg-gray-500 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                </div>
                
                <!-- Voice Toggle -->
                <div class="flex items-center justify-between p-3 bg-theme-main rounded-xl border border-theme">
                    <div class="flex items-center gap-3">
                        <i data-lucide="volume-2" class="w-5 h-5 text-blue-400"></i>
                        <span class="font-bold text-sm text-theme-main">Voice Sound</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="voice-toggle" class="sr-only peer" checked>
                        <div class="w-9 h-5 bg-gray-500 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                </div>

                <button onclick="saveSettings()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg mt-2 text-sm">
                    Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- SUCCESS POPUP -->
    <div id="success-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] hidden flex items-center justify-center">
        <div class="bg-theme-card p-6 rounded-3xl shadow-2xl flex flex-col items-center gap-3 border border-theme transform scale-95 transition-all w-64" id="success-content">
            <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center shadow-lg shadow-green-900/50">
                <i data-lucide="check" class="w-8 h-8 text-white stroke-[3]"></i>
            </div>
            <div class="text-center">
                <h3 class="text-lg font-bold text-theme-main" id="modal-title">Saved!</h3>
                <p class="text-xs text-theme-muted" id="modal-desc">Entry update ho gayi.</p>
            </div>
        </div>
    </div>

    <!-- EDIT CONFIRMATION MODAL -->
    <div id="confirm-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[80] hidden flex items-center justify-center p-4">
        <div class="bg-theme-card w-full max-w-xs p-5 rounded-2xl border border-theme shadow-2xl text-center">
            <div class="w-12 h-12 bg-amber-500/20 text-amber-500 rounded-full flex items-center justify-center mx-auto mb-3">
                <i data-lucide="alert-circle" class="w-6 h-6"></i>
            </div>
            <h3 class="text-lg font-bold text-theme-main mb-1">Edit Karna Hai?</h3>
            <p class="text-xs text-theme-muted mb-4">Aap purani date ki entry change karne ja rahe hain.</p>
            <div class="flex gap-3">
                <button id="btn-cancel-edit" class="flex-1 py-2 rounded-xl bg-theme-main text-theme-muted font-bold text-sm">Nahi</button>
                <button id="btn-confirm-edit" class="flex-1 py-2 rounded-xl bg-blue-600 text-white font-bold text-sm">Haan, Edit</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html> 